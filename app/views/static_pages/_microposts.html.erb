<% @following_microposts.each do |micropost| %>
    <div class="post-container">
        <div class="post-side-frame">
            <figure class="post-avatar">
                <%= link_to user_path(micropost.user) do %>
                    <% if micropost.user.profile_image.present? %>
                        <%= image_tag attachment_url(micropost.user, :profile_image, :fill, 50, 50, format: "jpg"), {class: "mypage-image"} %>
                    <% else %>
                        <%= image_tag ("default.png"), :size => '50x50' %>
                    <% end %>
                <% end %>
            </figure>
        </div>
        <div class="post-main-frame">
            <div class="post-name">
                <%= link_to micropost.user.username, user_path(micropost.user) %>
            </div>
            <div class="post-body">
                <span><%= safe_join(micropost.body.split("\n"), tag(:br)) %></span>
            </div>
            <div class="frame-details">
                <div id="like-btn-<%= micropost.id %>">
                    <%= render 'likes/like', micropost: micropost %>
                </div>
                <div class="post-date">
                    <span class="text-muted"><%= l micropost.created_at %></span>
                </div>
                <div class="post-timestamp">
                    <span class="timestamp text-muted">
                        <%= time_ago_in_words(micropost.created_at) %> 前の投稿
                    </span>
                </div>
            </div>
            <div class="like-container" id="micropost-like-avatar-<%= micropost.id %>" >
                <%= render 'likes/like_avatar', micropost: micropost %>
            </div>
            <% if micropost.comments.count > 2 %>
                <% micropost.comments.first(2).each do |c| %>
                    <div class="comment-container">
                        <div class="comment-side-frame">
                            <div class="comment-avatar">
                                <% if c.user.profile_image.present? %>
                                    <%= image_tag attachment_url(c.user, :profile_image, :fill, 50, 50, format: "jpg"), {class:"comment-user-icon"} %>
                                <% else %>
                                    <%= image_tag ("default.png"), :size => '50x50', class:"comment-user-icon" %>
                                <% end %>
                            </div>
                        </div>
                        <div class="comment-main-frame">
                            <div class="comment-name">
                                <%= link_to c.user.username, user_path(c.user.id) %>
                            </div>
                            <div class="comment-body">
                                <span><%= safe_join(c.content.split("\n"), tag(:br)) %></span>
                            </div>
                            <span class="comment-date text-muted"><%= l c.created_at %></span>
                        </div>
                    </div> 
                <% end %>
                <div id="micropost-comment-count-<%= micropost.id %>">
                    <%= render 'static_pages/micropost_comment_count', micropost: micropost %>
                </div>
            <% else %>
                <div id="micropost-comment-view-<%= micropost.id %>">
                    <%= render 'static_pages/micropost_comment_view', micropost: micropost %>
                </div>
            <% end %>
            <% if user_signed_in? %>
                <div class="comment-create">
                    <%= form_for [@comment], remote: true do |f| %>
                        <div class="js-text" id="micropost-val-<%= micropost.id %>">
                            <%= f.text_area :content, placeholder: "コメントする", :size => "30x1", class: "form-control js-text-field" %>
                        </div>
                        <span class="text-count"></span><span class="js-text-count"></span>
                        <br>
                        <%= f.hidden_field :micropost_id, value: micropost.id, class: "hidden_field" %>
                        <%= f.submit "コメントする", class: "js-submit btn btn-primary" %>
                    <% end %>
                </div>
            <% else %>
            <% end %>
        </div>
    </div>
<% end %>